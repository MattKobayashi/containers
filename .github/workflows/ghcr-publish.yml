---
name: Publish images to GHCR.io

on:
  schedule:
    - cron: '0 3 * * SAT'
  push:
    branches: [main]
    # Publish semver tags as releases.
    tags: ['v*.*.*']
  pull_request:
    branches: [main]
  workflow_dispatch:

env:
  # Use docker.io for Docker Hub if empty
  REGISTRY: ghcr.io

jobs:
  build-actions-runner:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'actions-runner' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-avahi:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'avahi' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-certbot-cloudflare:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'certbot-cloudflare' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-fullbogons:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'fullbogons' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two env variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-iperf2:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'iperf2' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-iperf3:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'iperf3' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  # build-irrd:

  #   runs-on: self-hosted
  #   if: ${{ github.ref_name == 'main' || github.head_ref == 'irrd' }}
  #   permissions:
  #     contents: read
  #     packages: write

  #   steps:
  #     # Add support for more platforms with QEMU (optional)
  #     # https://github.com/docker/setup-qemu-action
  #     - name: Set up QEMU
  #       uses: docker/setup-qemu-action@v3

  #     # Set up Docker Buildx
  #     # https://github.com/docker/setup-buildx-action
  #     - name: Set up Docker Buildx
  #       uses: docker/setup-buildx-action@v3
  #       with:
  #         config-inline: |
  #           [registry."docker.io"]
  #             mirrors = ["registry-mirror:5000"]
  #           [registry."registry-mirror:5000"]
  #             http = true
  #         driver-opts: |
  #           network=actions-runners

  #     # Gives two environment variables
  #     # One with lowercase repo owner's name
  #     # Another with the name of the image
  #     - name: Set image name
  #       run: |
  #         echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
  #         echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

  #     # Checkout repository
  #     # https://github.com/actions/checkout
  #     - name: Checkout repository
  #       uses: actions/checkout@v4

  #     # Login against a Docker registry except on PR
  #     # https://github.com/docker/login-action
  #     - name: Log into registry ${{ env.REGISTRY }}
  #       if: |
  #         github.event_name == 'push' ||
  #         github.event_name == 'schedule'
  #       uses: docker/login-action@v3
  #       with:
  #         registry: ${{ env.REGISTRY }}
  #         username: ${{ github.actor }}
  #         password: ${{ secrets.GITHUB_TOKEN }}

  #     # Build and push Docker image with Buildx (don't push on PR)
  #     # https://github.com/docker/build-push-action
  #     - name: Build and push Docker image
  #       uses: docker/build-push-action@v5
  #       with:
  #         context: ./${{ env.IMAGE_NAME }}
  #         push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
  #         tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  # build-irrexplorer:

  #   runs-on: self-hosted
  #   if: ${{ github.ref_name == 'main' || github.head_ref == 'irrexplorer' }}
  #   permissions:
  #     contents: read
  #     packages: write

  #   steps:
  #     # Add support for more platforms with QEMU (optional)
  #     # https://github.com/docker/setup-qemu-action
  #     - name: Set up QEMU
  #       uses: docker/setup-qemu-action@v3

  #     # Set up Docker Buildx
  #     # https://github.com/docker/setup-buildx-action
  #     - name: Set up Docker Buildx
  #       uses: docker/setup-buildx-action@v3
  #       with:
  #         config-inline: |
  #           [registry."docker.io"]
  #             mirrors = ["registry-mirror:5000"]
  #           [registry."registry-mirror:5000"]
  #             http = true
  #         driver-opts: |
  #           network=actions-runners

  #     # Gives two environment variables
  #     # One with lowercase repo owner's name
  #     # Another with the name of the image
  #     - name: Set image name
  #       run: |
  #         echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
  #         echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

  #     # Checkout repository
  #     # https://github.com/actions/checkout
  #     - name: Checkout repository
  #       uses: actions/checkout@v4

  #     # Login against a Docker registry except on PR
  #     # https://github.com/docker/login-action
  #     - name: Log into registry ${{ env.REGISTRY }}
  #       if: |
  #         github.event_name == 'push' ||
  #         github.event_name == 'schedule'
  #       uses: docker/login-action@v3
  #       with:
  #         registry: ${{ env.REGISTRY }}
  #         username: ${{ github.actor }}
  #         password: ${{ secrets.GITHUB_TOKEN }}

  #     # Build and push Docker image with Buildx (don't push on PR)
  #     # https://github.com/docker/build-push-action
  #     - name: Build and push Docker image
  #       uses: docker/build-push-action@v5
  #       with:
  #         context: ./${{ env.IMAGE_NAME }}
  #         push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
  #         tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-mdns-reflector:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'mdns-reflector' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-rng-tools:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'rng-tools' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-speedtest:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'speedtest' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-stun:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'stun' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-telegraf:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'telegraf' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-verlihub:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'verlihub' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-vyos-blog-alert:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'vyos-blog-alert' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-xteve:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'xteve' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest

  build-yancobat:

    runs-on: self-hosted
    if: ${{ github.ref_name == 'main' || github.head_ref == 'yancobat' }}
    permissions:
      contents: read
      packages: write

    steps:
      # Add support for more platforms with QEMU (optional)
      # https://github.com/docker/setup-qemu-action
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      # Set up Docker Buildx
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          config-inline: |
            [registry."docker.io"]
              mirrors = ["registry-mirror:5000"]
            [registry."registry-mirror:5000"]
              http = true
          driver-opts: |
            network=actions-runners

      # Gives two environment variables
      # One with lowercase repo owner's name
      # Another with the name of the image
      - name: Set image name
        run: |
          echo "REPO_NAME=${GITHUB_REPOSITORY_OWNER,,}" >> ${GITHUB_ENV} &&
          echo "IMAGE_NAME=${GITHUB_JOB#*-}" >> ${GITHUB_ENV}

      # Checkout repository
      # https://github.com/actions/checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: |
          github.event_name == 'push' ||
          github.event_name == 'schedule'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./${{ env.IMAGE_NAME }}
          push: ${{ github.event_name == 'push' || github.event_name == 'schedule' }}
          tags: ${{ env.REGISTRY }}/${{ env.REPO_NAME }}/${{ env.IMAGE_NAME }}:latest
